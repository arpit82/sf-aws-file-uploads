# Salesforce → Amazon S3 Direct File Upload (Production Architecture)

A production-ready pattern where **Salesforce** orchestrates the workflow and the **browser uploads directly to Amazon S3** using short-lived presigned URLs generated by **AWS Lambda + API Gateway**, authenticated via a **Salesforce External Credential + Named Credential**.

This solution avoids Apex binary handling entirely and supports secure, scalable upload flows with a Lightning Web Component progress bar.

---

## Table of Contents

- [Overview](#overview)
- [Architecture Diagram](#architecture-diagram)
- [Repo Structure](#repo-structure)
- [Prerequisites](#prerequisites)
- [AWS Setup](#aws-setup)
  - [1. Create S3 Bucket](#1-create-s3-bucket)
  - [2. Configure IAM Role](#2-configure-iam-role)
  - [3. Lambda Setup](#3-lambda-setup)
  - [4. API Gateway Setup](#4-api-gateway-setup)
  - [5. Usage Plan + API Key](#5-usage-plan--api-key)
- [Salesforce Setup](#salesforce-setup)
  - [1. External Credential](#1-external-credential)
  - [2. Permission Set Mapping](#2-permission-set-mapping)
  - [3. Named Credential](#3-named-credential)
  - [4. CSP Trusted Sites](#4-csp-trusted-sites)
  - [5. Deploy Apex](#5-deploy-apex)
  - [6. Deploy LWC](#6-deploy-lwc)
- [Testing](#testing)
- [Troubleshooting](#troubleshooting)
- [Security Notes](#security-notes)
- [Appendix](#appendix)

---

# Overview

This implementation supports:

- Direct **browser → S3 uploads**
- **No file bodies pass through Apex**
- **AWS Lambda** generates short-lived presigned URLs
- **API Gateway** authenticates using API Key
- **Salesforce Named Credential + External Credential** securely pass the API key
- LWC uses **XHR** to upload files with a progress bar

**AWS Services**
- Amazon S3  
- AWS Lambda (Python, boto3)  
- Amazon API Gateway  
- IAM  

**Salesforce Components**
- Named Credential  
- External Credential  
- Apex service classes  
- Lightning Web Component uploader  
